<?php

/**
 * @Autor	: Diego Lepera
 * @E-mail	: d_lepera@hotmail.com
 * @Projeto	: FrameworkDL
 * @Data	: 07/01/2015 18:34:49
 */

if( !isset($params) )
    $params = $this->_obterparams();

$mod = $params['modelo'];

?>

[DL3-CONTEUDO]
    <form id="form-<?php echo $params['form-id']; ?>" method="post" action="<?php echo $params['form-action']; ?>">
        <?php if( !$params['incluindo'] ): ?>
        <input type="hidden" name="id" value="<?php echo $mod->id; ?>"/>
        <?php endif; ?>

        <p class="form-paragr">
	        <?php echo $this->aux_form->_combo_select('tipo', 'tipo', $mod->tipo, TXT_ROTULO_TIPO, null, ['required' => 'required'],
		        array_merge([['VALOR' => '', 'TEXTO' => TXT_OPCAO_SELECIONE_UMA_OPCAO]], $params['tipos'])
	        ); ?>

            <?php
	        if( $params['novo-tipo?'] )
                echo $this->aux_links->_link('inserir', 'javascript:', sprintf(TXT_LINK_NOVO, TXT_MODELO_TIPODADOCONTATO), null, true, [
	                'data-acao' => 'carregar-form',
	                'data-acao-param-html' => 'website/tipos-de-dados/novo',
                    'data-acao-param-func' => "CarregarSelect($('#sel-tipo'), 'website/tipos-de-dados/carregar-select')",
	                'data-ajax' => true,
	                'data-ajax-msg' => TXT_AJAX_CARREGANDO_CONTEUDO
                ]);
	        ?>
        </p>

        <p class="form-paragr">
            <?php echo $this->aux_form->_campo_geral('texto', 'descr', 'descr', $mod->descr, TXT_ROTULO_DESCR, null, [
	            'pattern' => isset($params['expreg']) ? $params['expreg'] : null,
                'required' => 'required'
            ]); ?>
        </p>

        <p class="form-paragr">
	        <?php echo $this->aux_form->_chk_sim_nao('publicar', 'publicar', TXT_ROTULO_PUBLICAR, null, $mod->publicar ? ' CHECKED' : ''); ?>
        </p>

        <p class="form-botoes">
            <?php
            echo $this->aux_form->_botao('salvar', TXT_BOTAO_SALVAR);
            echo $this->aux_form->_botao('cancelar', TXT_BOTAO_CANCELAR);
            ?>
        </p>
    </form>
[/DL3-CONTEUDO]

[DL3-SCRIPTS]
<script>
    //<![CDATA[
    <?php if( !empty($params['mascara']) ): ?>
    // Aplicar a m√°scara
    $('#txt-descr')._mascara('<?php echo $params['mascara']; ?>');
    <?php endif; ?>

    $('#sel-tipo').on('change', function(){
        var tipo = $(this).val();

        $.ajax({
            url     : 'website/tipos-de-dados/opcoes-avancadas',
            type    : 'post',
            dataType: 'json',
            data    : 'id='+ tipo,
            success : function(j){
                var $descr = $('#txt-descr');

                if( j.mascara != '' )
                    $descr._mascara(j.mascara);

                if( j.expreg != '' )
                    $descr.attr({ pattern: j.expreg });
            }
        });
    });
    //]]>
</script>
[/DL3-SCRIPTS]
